<style>.ui-scanner{inset:0;position:absolute;background-color:#000;overflow:hidden}.ui-scanner-video{inset:0;object-fit:cover;width:100%}.ui-scanner-canvas{width:100%;height:auto;position:absolute;inset:0}.ui-scanner-photo{display:block;position:absolute;z-index:10;bottom:10px;left:10px;width:150px;scale:0.6;cursor:pointer}.ui-scanner-wrapper{position:relative;overflow:hidden}.ui-scanner-mask{position:absolute;z-index:15;box-shadow:0 0 0 99999px rgba(0,0,0,.4)}.ui-scanner-animation{position:absolute;top:0;left:0;right:0;width:100%;height:1px;background-color:#fff;animation:scanerlight 6s infinite;box-shadow:0 0px 15px 3px #fff}.ui-scanner-mask .corner{position:absolute;width:15px;height:15px}.ui-scanner-mask .corner.topleft{top:0;left:0;border-left:2px solid #fff;border-top:2px solid #fff}.ui-scanner-mask .corner.topright{top:0;right:0;border-right:2px solid #fff;border-top:2px solid #fff}.ui-scanner-mask .corner.bottomleft{bottom:0;left:0;border-left:2px solid #fff;border-bottom:2px solid #fff}.ui-scanner-mask .corner.bottomright{bottom:0;right:0;border-right:2px solid #fff;border-bottom:2px solid #fff}.ui-scanner-shoot{display:block;position:absolute;width:100px;height:100px;border-radius:50%;z-index:20;bottom:40px;left:50%;transform:translateX(-50px);background-color:#000;border:2px solid #d5d5d5;animation:shockwave 2s ease-in-out infinite;animation-duration:infinite;transition:all .5s ease-in-out;cursor:pointer}.ui-scanner-canvas{display:block;width:100%;height:auto;position:absolute;bottom:0;left:0;right:0;top:0}.ui-scanner-bigphoto{position:absolute;z-index:20;box-shadow:0 0 0 99999px rgb(0,0,0);border:1px solid #aaa}.ui-scanner-close{display:block;position:absolute;z-index:110;top:5px;right:5px;background-color:transparent;color:#eee;font-weight:bold;border:none;font-size:30px}.ui-scanner-btn{top:auto;z-index:20;transition:all .3s ease-in;color:#868789;font-size:30px;padding:10px;border:1px solid #505050;border-radius:10px;width:50px;height:50px;display:grid;place-items:center;cursor:pointer}.ui-scanner-btn:hover{background-color:#505050}.ui-scanner-discard{position:absolute;left:50%;bottom:65px;scale:0;opacity:0}.ui-scanner-accept{position:absolute;left:auto;right:50%;bottom:65px;scale:0;opacity:0;color:#fff}.ui-scanner-discard-open{scale:1;left:50px;opacity:1}.ui-scanner-accept-open{scale:1;right:50px;opacity:1}@media (max-height:620px){.ui-scanner-btn{top:auto;z-index:20;transition:all .3s ease-in;color:#868789;font-size:24px;padding:0;border:1px solid #505050;border-radius:6px;width:40px;height:40px;display:block;text-align:center;line-height:40px;bottom:27px}.ui-scanner-shoot{width:66px;height:66px;border-radius:50%;transform:translateX(-33px);bottom:27px}.ui-scanner-discard{position:absolute;left:50%;scale:0;opacity:0}.ui-scanner-accept{position:absolute;left:auto;right:50%;scale:0;opacity:0;color:#fff}.ui-scanner-discard-open{scale:1;left:50px;opacity:1}.ui-scanner-accept-open{scale:1;right:50px;opacity:1}}@keyframes scanerlight{0%{top:0}50%{top:100%}100%{top:0}}@keyframes shockwave{0%{box-shadow:0 0 2px #aaa}50%{box-shadow:0 0 50px #aaa,inset 0 0 10px #d5d5d5}100%{box-shadow:0 0 2px #aaa}}@keyframes shockwaveaccept{0%{box-shadow:0 0 2px #aaa}50%{box-shadow:0 0 50px #2196f3,inset 0 0 10px #2196f3}100%{box-shadow:0 0 2px #aaa}}</style>
<script>COMPONENT('scanner@1',function(self,config,cls){var cls2='.'+cls,constraints={video:{facingMode:'environment'},audio:false},bottomspace=WH>620?'40px':'10px',canvas,stream,video,close,shoot,photo,streaming=false,ctx,mask,wrapper,skip=false,bigphoto,accept,discard;self.make=function(){self.aclass('hidden '+cls);self.html('<div class="{0}-wrapper"><video class="{0}-video" playsinline autoplay ></video><canvas class="{0}-canvas" style="position:absolute;left:0;top:0;right:0;bottom:0"></canvas><div class="{0}-mask"><div class="{0}-animation"></div><div class="corner topleft"></div><div class="corner topright"></div><div class="corner bottomleft"></div><div class="corner bottomright"></div></div></div><img class="{0}-bigphoto" alt="bigscreen" /><button class="{0}-close"><i class="fal fa-times-circle"></i></button><div class="{0}-btn {0}-discard"><i class="fal fa-times"></i></div><div class="{0}-btn {0}-accept"><i class="fal fa-check"></i></div><button class="{0}-shoot"></button>'.format(cls));video=self.find(cls2+'-video');canvas=self.find(cls2+'-canvas');close=self.find(cls2+'-close');shoot=self.find(cls2+'-shoot');photo=self.find(cls2+'-photo');mask=self.find(cls2+'-mask');wrapper=self.find(cls2+'-wrapper');bigphoto=self.find(cls2+'-bigphoto');accept=self.find(cls2+'-accept');discard=self.find(cls2+'-discard');photo.aclass('hidden');bigphoto.aclass('hidden');ctx=canvas[0].getContext('2d');close.on('click',function(){self.close()});photo.on('click',function(){var picwidth=mask.width()+'px';photo.css({width:picwidth,scale:1})});accept.on('click',function(){self.accept()});discard.on('click',function(){self.discard()})};var render=function(){if(streaming){var c=canvas[0];c.width=WW;c.height=wrapper.height();ctx.drawImage(video[0],0,0,c.width,c.height);ctx.beginPath();var lr=(((c.width/100)*self.opt.points[0])/2)>>0;var tb=(((c.height/100)*self.opt.points[1])/2)>>0;if(!skip){canvas.css({height:c.height+'px',width:c.width+'px'});mask.css('inset','{0} {1}'.format(tb+'px',lr+'px'));skip=true}requestAnimationFrame(render)}};self.show=function(opt){self.opt=opt;self.rclass('hidden');if(opt.size==='A4')opt.points=[35,30];navigator.mediaDevices.getUserMedia(constraints).then(function(response){stream=response;video[0].srcObject=stream;video[0].play();video.on('canplay',function(){if(!streaming){canvas.attr({width:video[0].videoWidth,height:video[0].videoHeight});streaming=true;self.clear();render()}});shoot.on('click',function(){self.shoot()});self.clear()}).catch(function(err){console.log(err)})};self.close=function(){stream.getTracks().forEach(function(track){track.stop();self.element.aclass('hidden');photo.aclass('hidden');bigphoto.aclass('hidden');mask.rclass('hidden');shoot.css({opacity:1,bottom:bottomspace});accept.rclass(cls+'-accept-open');discard.rclass(cls+'-discard-open')})};self.shoot=function(){photo.rclass('hidden');bigphoto.rclass('hidden');var c=canvas[0],lr=(((c.width/100)*self.opt.points[0])/2)>>0;var tb=(((c.height/100)*self.opt.points[1])/2)>>0;var target=document.createElement('CANVAS');var ctxtmp=target.getContext('2d');target.width=c.width-lr*2;target.height=c.height-tb*2;ctxtmp.drawImage(c,-lr,-tb,c.width,c.height);var base64=target.toDataURL('image/png');config.exec&&self.SEEX(config.exec,base64);self.base64=base64;bigphoto.attr('src',base64);bigphoto.css({top:tb,left:lr});mask.aclass('hidden');shoot.css({opacity:0,bottom:'-100vh'});accept.aclass(cls+'-accept-open');discard.aclass(cls+'-discard-open')};self.discard=function(){shoot.css({opacity:1,bottom:bottomspace});accept.rclass(cls+'-accept-open');discard.rclass(cls+'-discard-open');bigphoto.aclass('hidden');mask.rclass('hidden')};self.accept=function(){self.opt.callback(self.base64)};self.clear=function(){ctx.fillStyle='#eee';ctx.fillRect(0,0,canvas[0].width,canvas[0].height);var base64=canvas[0].toDataURL('image/png');photo.attr('src',base64)}});</script>